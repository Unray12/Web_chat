{% extends 'base.html' %}
{% block content %}
<div class="roomHeader">
    <h2 class="roomCode">Chat room: {{code}}</h2>
</div>
<div class="messageBox">
    <div class="messages" id="messages"></div>
    <div class="inputChat">
        <input 
            type="text" 
            rows="3"
            placeholder="type a message"
            name="message"
            id="message"
        >
        <button
            type="button"
            name="send"
            id="sendButton"
            onclick="sendMessage()">
                     
        </button>
    </div>
</div>
<script type="text/javascript">
    var socketio = io();
    var orderMessage = 0;
    const messages = document.getElementById("messages");
    const message = document.getElementById("message");

    
    function getSizeOfInbox(stringMsg) {
        var textBox = document.querySelectorAll(".textBox");
        
        var maxWWidthInbox = 500;

        var length = stringMsg.length * 12;
        textBoxCurrent = textBox[orderMessage - 1];

        if (length > maxWWidthInbox) {
            var numRow = Math.ceil(length / 500);
            textBoxCurrent.style.width = '500' + "px";
        }
        else
            textBoxCurrent.style.width = length + "px";
    }
    // <strong>${name}</strong>: ${msg}
    const createMessage = (name, msg) => {
        const content = `
    <div class="text">
        <span class = "textBox ${orderMessage}">
            <p>
                ${msg}
            </p>
        </span>
        <span class="muted">
            ${new Date().toLocaleString()}
        </span>
    </div>
    `;
        messages.innerHTML += content;
        orderMessage++;
    };

    socketio.on("message", (data) => {
        createMessage(data.name, data.message);
        getSizeOfInbox(data.message);
    });

    const sendMessage = () => {
        if (message.value == "") return;
        socketio.emit("message", {data: message.value});
        message.value = "";
    };

    //press enter to send message
    message.onkeydown = function(e) {
        switch (e.which) {
            case 13:
                sendMessage();
                break;
        }
    };

</script>
{% for msg in messages %}
<script type="text/javascript">
  createMessage("{{msg.name}}", "{{msg.message}}");
</script>
{% endfor %} 
{% endblock %}